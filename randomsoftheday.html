<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#E82B38" />
<meta name="description" content="THE Randoms - Randoms Of The Day" />
<title>Randoms Of The Day - THE Randoms</title>
<link rel="icon" type="image/png" href="./img/pfp.png" />
<link href="https://fonts.googleapis.com/css2?family=Jersey+10:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />
<style>
body {
  font-family: 'Jersey 10', sans-serif;
  font-size: 24px;
  margin: 0;
  padding: 0;
  background: #f9f9f9;
  color: #222;
}
.topnav {
  overflow: hidden;
  background-color: #333;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  height: 60px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
.logo-link { color: white; text-decoration: none; font-weight:700; font-size:24px; cursor:pointer; display:flex; align-items:center; height:60px;}
.logo-link:hover,.logo-link:focus{color:white;outline:none;text-decoration:none;}
.menu-icon{font-size:30px;color:white;cursor:pointer;}
.topnav-right{
  display:none;
  position:fixed;
  top:60px;
  left:0;
  right:0;
  bottom:0; 
  background-color:#333;
  flex-direction:column;
  overflow-y:auto;
  z-index:999;
}
.topnav.active+.topnav-right{display:flex;}
body.menu-open{overflow:hidden;}
.accordion-toggle{background:none;color:#f2f2f2;padding:14px;text-align:left;font-size:24px;border:none;outline:none;cursor:pointer;width:100%;font-family:'Jersey 10',sans-serif;}
.accordion-content{display:none;flex-direction:column;background-color:#444;}
.accordion-content a{padding-left:28px;padding-top:10px;padding-bottom:10px;border-top:1px solid #555;font-size:20px;color:#f2f2f2;text-decoration:none;}
.accordion-content a:hover,.accordion-content a:focus{background-color:rgba(255 255 255 / 0.15);outline:none;}
.accordion-section{display:flex;flex-direction:column;border-top:1px solid #444;}
.accordion-section.open .accordion-content{display:flex;}
.content{max-width:800px;margin:40px auto;padding:0 16px;text-align:center;color:#222;}
.content h1{margin-bottom:20px;font-weight:700;}
.content p{line-height:1.6;font-size:20px;}
.random-section{margin:24px 0;padding:16px;background:white;border-radius:8px;box-shadow:0 2px 5px rgb(0 0 0 / 0.1);text-align:left;}
.random-section h2{margin-top:0;font-size:22px;color:#E82B38;font-weight:700;border-bottom:2px solid #E82B38;padding-bottom:6px;}
.random-content{margin-top:10px;font-size:18px;min-height:48px;}
</style>
</head>
<body>
<header>
  <div class="topnav">
    <h1><a class="logo-link" href="/">THE Randoms</a></h1>
    <span class="menu-icon" onclick="toggleMenu()">&#9776;</span>
  </div>
  <nav class="topnav-right" aria-label="Site navigation">
    <div class="accordion-section">
      <button class="accordion-toggle" aria-expanded="false">Jokes & Fun</button>
      <div class="accordion-content" hidden>
        <a href="jokes.html">Jokes</a>
        <a href="memes.html">Memes</a>
        <a href="nfl.html">NFL</a>
        <a href="quizzes.html">Quizzes</a>
        <a href="wouldyourather.html">Would You Rather</a>
      </div>
    </div>
    <div class="accordion-section">
      <button class="accordion-toggle" aria-expanded="false">Knowledge & Facts</button>
      <div class="accordion-content" hidden>
        <a href="advice.html">Advice</a>
        <a href="facts.html">Facts</a>
        <a href="pages.html">Pages</a>
        <a href="people.html">People</a>
        <a href="quotes.html">Quotes</a>
      </div>
    </div>
    <div class="accordion-section">
      <button class="accordion-toggle" aria-expanded="false">Music & Videos</button>
      <div class="accordion-content" hidden>
        <a href="songs.html">Songs</a>
        <a href="videos.html">Videos</a>
      </div>
    </div>
    <div class="accordion-section">
      <button class="accordion-toggle" aria-expanded="false">Words, Letters & Numbers</button>
      <div class="accordion-content" hidden>
        <a href="letters.html">Letters</a>
        <a href="numbers.html">Numbers</a>
        <a href="words.html">Words</a>
      </div>
    </div>
  </nav>
</header>

<main class="content" role="main" aria-live="polite">
  <h1>Randoms Of The Day</h1>
  <p>Here Are Your Randoms Of The Day For <span id="current-date"></span></p>

  <section class="random-section" id="random-joke">
    <h2>Joke</h2>
    <div class="random-content">Loading joke...</div>
  </section>
  <section class="random-section" id="random-advice">
    <h2>Advice</h2>
    <div class="random-content">Loading advice...</div>
  </section>
  <section class="random-section" id="random-fact">
    <h2>Fact</h2>
    <div class="random-content">Loading fact...</div>
  </section>
  <section class="random-section" id="random-meme">
    <h2>Meme</h2>
    <div class="random-content">Loading meme...</div>
  </section>
  <section class="random-section" id="random-word">
    <h2>Word</h2>
    <div class="random-content">Loading word...</div>
  </section>
  <section class="random-section" id="random-number">
    <h2>Number</h2>
    <div class="random-content">Loading number...</div>
  </section>
  <section class="random-section" id="random-letter">
    <h2>Letter</h2>
    <div class="random-content">Loading letter...</div>
  </section>
</main>

<script>
const testingMode = false;

// Hamburger menu toggle
function toggleMenu() {
  document.querySelector('.topnav').classList.toggle('active');
  document.body.classList.toggle('menu-open');
}

// Accordion
document.querySelectorAll('.accordion-toggle').forEach(toggle => {
  toggle.addEventListener('click', () => {
    const parent = toggle.parentElement;
    const isOpen = parent.classList.contains('open');
    document.querySelectorAll('.accordion-section').forEach(section => {
      section.classList.remove('open');
      section.querySelector('.accordion-toggle').setAttribute('aria-expanded', 'false');
      section.querySelector('.accordion-content').hidden = true;
    });
    if (!isOpen) {
      parent.classList.add('open');
      toggle.setAttribute('aria-expanded', 'true');
      parent.querySelector('.accordion-content').hidden = false;
    }
  });
});

// Date utilities
function getDaySeed() {
  const now = new Date();
  const localMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  return Math.floor(localMidnight.getTime() / (1000*60*60*24));
}

function getLocalDateString() {
  const now = new Date();
  const localMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  return localMidnight.toISOString().slice(0,10);
}

function renderCurrentDate() {
  const container = document.getElementById('current-date');
  if (!container) return;
  container.textContent = new Date().toLocaleDateString('en-US',{month:'long',day:'numeric'});
}

// Generic cache fetch
async function fetchCached(key, fetchFn, useCache=true) {
  const today = getLocalDateString();
  const cacheKey = `daily_${key}`;
  const cacheDateKey = `daily_${key}_date`;
  if (useCache) {
    const cachedData = localStorage.getItem(cacheKey);
    const cachedDate = localStorage.getItem(cacheDateKey);
    if (cachedData && cachedDate === today) return cachedData;
  }
  try {
    const freshData = await fetchFn();
    localStorage.setItem(cacheKey, freshData);
    localStorage.setItem(cacheDateKey, today);
    return freshData;
  } catch (err) {
    console.error(`Error fetching ${key}:`, err);
    return localStorage.getItem(cacheKey) || `Could not load ${key} today.`;
  }
}

// Letters & numbers (instant)
function renderLetter() {
  const container = document.querySelector('#random-letter .random-content');
  if (!container) return;
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const index = testingMode ? Math.floor(Math.random() * letters.length) : getDaySeed() % letters.length;
  container.textContent = letters[index];
}

function renderNumber() {
  const container = document.querySelector('#random-number .random-content');
  if (!container) return;
  const num = testingMode ? Math.floor(Math.random() * 1000000) + 1 : (getDaySeed() * 9301 + 49297) % 1000000 + 1;
  container.textContent = num.toLocaleString();
}

// Word of the Day with API
async function renderWord() {
  const container = document.querySelector('#random-word .random-content');
  if (!container) return;

  const today = getLocalDateString();
  const cacheKey = 'daily_word';
  const cacheDateKey = 'daily_word_date';

  const cachedWord = localStorage.getItem(cacheKey);
  const cachedDate = localStorage.getItem(cacheDateKey);
  if (cachedWord && cachedDate === today) {
    container.textContent = cachedWord;
    return;
  }

  try {
    // âœ… switched to Vercel endpoint
    const res = await fetch('https://random-word-api.vercel.app/api?words=1');
    if (!res.ok) throw new Error('Word fetch failed');
    const data = await res.json();
    const chosenWord = data[0];

    localStorage.setItem(cacheKey, chosenWord);
    localStorage.setItem(cacheDateKey, today);

    container.textContent = chosenWord;
  } catch (err) {
    console.error('Error fetching word:', err);
    const fallbackWords = [
      "random","fun","color","code","web","page","day","fact","letter","test"
    ];
    const chosenWord = fallbackWords[getDaySeed() % fallbackWords.length];
    container.textContent = chosenWord;
    localStorage.setItem(cacheKey, chosenWord);
    localStorage.setItem(cacheDateKey, today);
  }
}

// Jokes, advice, facts, memes
async function fetchJoke(){const res=await fetch('https://official-joke-api.appspot.com/jokes/random');if(!res.ok)throw new Error('Joke fetch failed');const data=await res.json();return `${data.setup} ${data.punchline}`;}
async function renderJoke(useCache=true){const container=document.querySelector('#random-joke .random-content');if(!container)return;container.textContent=await fetchCached('joke',fetchJoke,useCache);}

async function fetchAdvice(){const res=await fetch('https://api.adviceslip.com/advice');if(!res.ok)throw new Error('Advice fetch failed');const data=await res.json();return data.slip.advice;}
async function renderAdvice(useCache=true){const container=document.querySelector('#random-advice .random-content');if(!container)return;container.textContent=await fetchCached('advice',fetchAdvice,useCache);}

async function fetchFact(){const res=await fetch('https://uselessfacts.jsph.pl/random.json?language=en');if(!res.ok)throw new Error('Fact fetch failed');const data=await res.json();return data.text;}
async function renderFact(useCache=true){const container=document.querySelector('#random-fact .random-content');if(!container)return;container.textContent=await fetchCached('fact',fetchFact,useCache);}

async function fetchMeme(){
  const subs=['memes','dankmemes','funny'];
  const seed=getDaySeed();
  const selectedSub=subs[seed%subs.length];
  const url=`https://www.reddit.com/r/${selectedSub}/hot.json?limit=50`;
  const proxyUrl=`https://corsproxy.io/?${encodeURIComponent(url)}`;
  const res=await fetch(proxyUrl);
  if(!res.ok)throw new Error('Meme fetch failed');
  const json=await res.json();
  const memes=json.data.children.filter(post=>post.data.url && /\.(jpg|jpeg|png)$/i.test(post.data.url));
  if(memes.length===0)throw new Error('No memes found');
  return memes[seed%memes.length].data.url;
}

async function renderMeme(useCache=true){
  const container=document.querySelector('#random-meme .random-content');
  if(!container)return;
  try{
    const memeUrl=await fetchCached('meme',fetchMeme,useCache);
    container.innerHTML=`<img src="${memeUrl}" alt="Daily Meme" style="max-width:100%;border-radius:8px;margin-top:10px;" />`;
  }catch{return container.textContent='Failed to load meme.';}
}

// Render from cache only
function renderFromCacheOnly(){
  const keys=[{id:'random-joke',key:'joke'},{id:'random-advice',key:'advice'},{id:'random-fact',key:'fact'},{id:'random-word',key:'word'},{id:'random-meme',key:'meme'}];
  keys.forEach(({id,key})=>{
    const container=document.querySelector(`#${id} .random-content`);
    const cachedData=localStorage.getItem(`daily_${key}`);
    if(!container)return;
    if(key==='meme') container.innerHTML=cachedData?`<img src="${cachedData}" alt="Daily Meme" style="max-width:100%;border-radius:8px;margin-top:10px;" />`:'No cached meme available.';
    else container.textContent=cachedData||`No cached ${key} available.`;
  });
  renderLetter();
  renderNumber();
  renderWord();
}

// Refresh all
async function refreshAll(){
  renderLetter();
  renderNumber();
  await renderWord();
  const useCache=!testingMode;
  await Promise.all([renderJoke(useCache), renderAdvice(useCache), renderFact(useCache), renderMeme(useCache)]);
}

// Schedule midnight refresh
function scheduleMidnightRefresh(){
  const now=new Date();
  const nextMidnight=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,0,0,0);
  setTimeout(async()=>{
    renderCurrentDate();
    await refreshAll();
    setInterval(async()=>{renderCurrentDate();await refreshAll();},24*60*60*1000);
  },nextMidnight-now);
}

// DOM Ready
document.addEventListener('DOMContentLoaded', async () => {
  renderCurrentDate();
  renderLetter();
  renderNumber();
  await renderWord();

  const today = getLocalDateString();
  const keys = ['joke','advice','fact','meme'];
  const hasFullCache = keys.every(key => {
    const cacheDate = localStorage.getItem(`daily_${key}_date`);
    const cacheData = localStorage.getItem(`daily_${key}`);
    return cacheData && cacheDate === today;
  });

  if (!hasFullCache) {
    await refreshAll();
  } else {
    renderFromCacheOnly();
  }

  scheduleMidnightRefresh();
});
</script>
<script src="holiday-theme.js" defer></script>
</body>
</html>
